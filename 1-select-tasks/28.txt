--PHANTOM READ

DROP TABLE IF EXISTS PhantomRead;
CREATE TABLE PhantomRead (
Id INTEGER PRIMARY KEY NOT NULL,
Value INTEGER NOT NULL
);

INSERT INTO PhantomRead VALUES(1,1);

--transaction 1
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
START TRANSACTION;
SELECT  *
FROM PhantomRead;
SELECT pg_sleep(7);
SELECT  *
FROM PhantomRead;
COMMIT;

--transaction 2
BEGIN;
INSERT INTO PhantomRead VALUES(2,30);
UPDATE PhantomRead
SET Value=10
WHERE Id=1;
SELECT pg_sleep(7);
ROLLBACK;
