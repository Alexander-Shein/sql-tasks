


 
 Ð“) --edite order 
 CREATE TYPE [dbo].[Type_EditOrder] 
 AS TABLE (
 [ProductID] int
 ,[UnitPrice] money
 ,[Quantity] smallint	
 ,[Discount] real
);


CREATE PROCEDURE [dbo].[EditOrder]
@ListOfOrderDetails AS [dbo].[Type_EditOrder] READONLY,
@EditOrder_OrderID int,
@EditOrder_CustomerID nchar(20),
@EditOrder_EmployeeID int,
@EditOrder_OrderDate datetime,
@EditOrder_RequiredDate datetime,
@EditOrder_ShippedDate datetime ,
@EditOrder_ShipVia int,
@EditOrder_Freight money,
@EditOrder_ShipName nvarchar(200),
@EditOrder_ShipAddress nvarchar(300),
@EditOrder_ShipCity nvarchar(50),
@EditOrder_ShipRegion nvarchar(70),
@EditOrder_ShipPostalCode nvarchar(15),
@EditOrder_ShipCountry nvarchar(70)
As 
BEGIN TRY
UPDATE  [dbo].[Orders]
	SET	
      [CustomerID] = @EditOrder_CustomerID
      ,[EmployeeID] = @EditOrder_EmployeeID 
      ,[OrderDate] = @EditOrder_OrderDate
      ,[RequiredDate] =  @EditOrder_RequiredDate
      ,[ShippedDate] = @EditOrder_ShippedDate
      ,[ShipVia] = @EditOrder_ShipVia 
      ,[Freight] = @EditOrder_Freight
      ,[ShipName] = @EditOrder_ShipName
      ,[ShipAddress] = @EditOrder_ShipAddress
      ,[ShipCity] = @EditOrder_ShipCity
      ,[ShipRegion] = @EditOrder_ShipRegion 
      ,[ShipPostalCode] = @EditOrder_ShipPostalCode
      ,[ShipCountry] = @EditOrder_ShipCountry
	  WHERE [OrderID] = @EditOrder_OrderID ;
	
	DELETE FROM [dbo].[Order Details] 
	WHERE [OrderID] = @EditOrder_OrderID;

	INSERT INTO [dbo].[Order Details](
					  [OrderID]
					 ,[ProductID] 
					 ,[UnitPrice] 
					 ,[Quantity] 	
					 ,[Discount])

	SELECT @EditOrder_OrderID
	,[ProductID]
	,[UnitPrice] 
	,[Quantity] 	
	,[Discount]
	FROM @ListOfOrderDetails;
	COMMIT;
END TRY
BEGIN CATCH
 SELECT  
    ERROR_NUMBER() AS ErrorNumber  
    ,ERROR_SEVERITY() AS ErrorSeverity  
    ,ERROR_STATE() AS ErrorState  
    ,ERROR_PROCEDURE() AS ErrorProcedure  
    ,ERROR_LINE() AS ErrorLine  
    ,ERROR_MESSAGE() AS ErrorMessage; 
ROLLBACK;
END CATCH

